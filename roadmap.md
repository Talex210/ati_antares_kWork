# Roadmap: Интеграция ATI.SU с Telegram (Node.js/TypeScript)

Этот документ описывает подробный план разработки проекта по автоматической публикации загрузок с ATI.SU в Telegram-группу. План составлен с учетом приоритета локальной разработки, использования современных и безопасных технологий, и развертывания на сервере на финальном этапе.

## Основные технологии

*   **Backend:** Node.js, TypeScript
*   **API-клиент:** Axios
*   **Telegram Bot:** node-telegram-bot-api
*   **Веб-фреймворк (для админ-панели):** Express.js
*   **База данных:** SQLite (для локальной разработки и простоты развертывания)
*   **Качество кода:** ESLint, Prettier

---

## План разработки

### Фаза 1: Локальная настройка и прототипирование (Оценка: 1 день)

**Цель:** Создать полностью рабочее локальное окружение и прототип, работающий с имитацией API (mock-данными).

1.  **Инициализация проекта:** - in work
    *   [x] Настроить проект с `npm` и `TypeScript` (`npm init`, `tsc --init`).
    *   [x] Установить и настроить `ESLint` и `Prettier` для обеспечения единого стиля и качества кода.
    *   [x] Установить основные зависимости последних версий: `node-telegram-bot-api`, `axios`, `express`, `sqlite3`, `dotenv`.
    *   [ ] Настроить `ts-node-dev` или `nodemon` для автоматической перезагрузки сервера при изменениях в коде.

2.  **Создание Mock-сервера для API ATI.SU:**
    *   [ ] Написать простой сервер на `Express.js`, который будет имитировать ответы API ATI.SU.
    *   [ ] Создать эндпоинты для получения списка загрузок (`/v1.0/loads/published`) и данных о логистах.
    *   [ ] Подготовить несколько вариантов JSON-ответов на основе документации (`doc_API_ATI.txt` и официальной) для тестирования различных сценариев (новые грузы, отсутствие грузов и т.д.).

3.  **Настройка Telegram-бота и базы данных:**
    *   [ ] Зарегистрировать бота в `@BotFather` и сохранить токен в `.env` файл.
    *   [ ] Написать базовый код для запуска бота и проверки связи с Telegram API.
    *   [ ] Настроить `SQLite` для хранения "белого списка" логистов и, возможно, истории опубликованных грузов.

### Фаза 2: Разработка основной логики (Оценка: 2 дня)

**Цель:** Реализовать всю бизнес-логику бота, используя локальные mock-данные.

1.  **Взаимодействие с Mock API:**
    *   [ ] Реализовать сервис для запросов к Mock API ATI.SU.
    *   [ ] Настроить основной цикл (поллинг), который с заданной периодичностью (например, раз в 5 минут) опрашивает Mock API на предмет новых загрузок.

2.  **Фильтрация и обработка данных:**
    *   [ ] Реализовать логику фильтрации грузов по "белому списку" логистов из локальной БД.
    *   [ ] Реализовать проверку на уникальность, чтобы не публиковать один и тот же груз дважды.
    *   [ ] Настроить логику форматирования сообщения для Telegram на основе полученных данных.

3.  **Публикация в Telegram:**
    *   [ ] Написать функцию для отправки отформатированных сообщений в указанную группу и тему (topic) Telegram.
    *   [ ] Реализовать надежную обработку ошибок (например, если Telegram API недоступен) и логирование.

### Фаза 3: Разработка админ-панели (Оценка: 1-2 дня)

**Цель:** Создать простой и безопасный веб-интерфейс для управления списком логистов.

1.  **Backend (Express/TypeScript):**
    *   [ ] Создать REST API эндпоинты для управления списком логистов (просмотр, добавление, удаление).
    *   [ ] Реализовать базовую, но надежную аутентификацию (например, по статичному паролю или JWT-токену, хранящемуся в `.env`).

2.  **Frontend (HTML/CSS/Vanilla JS):**
    *   [ ] Создать минималистичную HTML-страницу для админ-панели.
    *   [ ] Написать JavaScript-код для взаимодействия с Backend API (отображение списка, формы добавления/удаления).
    *   [ ] Применить базовые меры безопасности (экранирование вывода, защита от CSRF).

### Фаза 4: Развертывание и интеграция с реальным API (Оценка: 1 день)

**Цель:** Перенести приложение на сервер, подключить к реальному API и запустить в продуктивном режиме.

1.  **Подготовка сервера:**
    *   [ ] **Создать аккаунт для клиента на выбранном хостинге (VPS).**
    *   [ ] Настроить сервер: установить `Node.js`, `npm`, `Git`.
    *   [ ] Настроить `firewall`, разрешив только необходимые порты (SSH, HTTP/HTTPS).

2.  **Развертывание приложения:**
    *   [ ] Загрузить код на сервер через `Git`.
    *   [ ] Установить зависимости и настроить переменные окружения (`.env`) с реальными токенами (Telegram, ATI.SU).
    *   [ ] Настроить `systemd` или `pm2` для автоматического запуска и мониторинга приложения.
    *   [ ] (Опционально) Настроить `Nginx` как обратный прокси для админ-панели и подключить SSL-сертификат (Let's Encrypt).

3.  **Интеграция с реальным API ATI.SU:**
    *   [ ] Заменить в коде адреса Mock-сервера на реальные URL API ATI.SU.
    *   [ ] Убедиться, что все запросы к API ATI.SU корректно используют токен доступа.
    *   [ ] Провести финальное end-to-end тестирование с реальными данными.


### Фаза 5: Удаление не используемых библиотек

*   [ ] Нужно проанализировать и удалить неиспользуемые библиотеки, чтобы на сервере занимало как можно меньше места. Но ни как не повлияло на работу приложения. Дай рекомендации как можно оптимизировать чтобы на сервере потреблялось как можно меньше ресурса.

---

**Важно:** План является гибким и может быть скорректирован в зависимости от деталей и возникающих сложностей.
