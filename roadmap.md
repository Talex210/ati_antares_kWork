# Roadmap: Интеграция ATI.SU с Telegram (Node.js/TypeScript)

Этот документ описывает план разработки проекта по интеграции ATI.SU с Telegram с использованием Node.js и TypeScript, с фокусом на локальную разработку и последующий перенос на сервер.

## План разработки

### Фаза 1: Локальная настройка и прототипирование (День 1)

**Цель:** Создать полностью рабочее локальное окружение и прототип бота, работающий с фейковыми данными.

1.  **Инициализация проекта (Node.js & TypeScript):**
    *   [ ] Настроить проект: `npm init`, `tsc --init`.
    *   [ ] Установить и настроить `ESLint` и `Prettier` для поддержания качества кода.
    *   [ ] Установить основные зависимости последних версий: `node-telegram-bot-api`, `axios`, `express` (для админ-панели и мок-сервера), `sqlite3`, `sequelize` (или другая ORM).
    *   [ ] Настроить `nodemon` или `ts-node-dev` для автоматической перезагрузки при изменениях.

2.  **Создание Mock-сервера для API ATI.SU:**
    *   [ ] Написать простой `Express` сервер, который будет имитировать ответы API ATI.SU.
    *   [ ] Создать эндпоинты для получения списка "загрузок" и данных о "логистах".
    *   [ ] Подготовить несколько вариантов JSON-ответов для тестирования разных сценариев.
    *   [ ] Использовать документацию из @doc_API_ATI.txt и с сайта https://ati.su/developers/ для формирования структуры моковых данных.

3.  **Настройка Telegram-бота:**
    *   [ ] Зарегистрировать бота в @BotFather, получить токен.
    *   [ ] Написать базовый код для запуска бота локально и проверки связи с Telegram.

4.  **Настройка локальной базы данных:**
    *   [ ] Настроить `SQLite` и ORM для работы с таблицей логистов.
    *   [ ] Создать миграцию для таблицы `logisticians`.

### Фаза 2: Разработка основной логики (Дни 2-3)

**Цель:** Реализовать всю бизнес-логику бота, используя локальные мок-данные.

1.  **Взаимодействие с Mock API:**
    *   [ ] Написать сервис для запросов к локальному Mock-серверу ATI.SU.
    *   [ ] Реализовать основной цикл (поллинг), который с заданной периодичностью опрашивает Mock API на предмет новых "загрузок".

2.  **Фильтрация и обработка данных:**
    *   [ ] Реализовать логику фильтрации грузов по "белому списку" ID логистов из локальной БД.
    *   [ ] Реализовать проверку флага "Опубликовать в Telegram" у загрузки.
    *   [ ] Настроить логику определения нужной темы (topic) в Telegram на основе данных из мок-ответа.

3.  **Публикация в Telegram:**
    *   [ ] Написать функцию для форматирования и отправки сообщений в нужную тему Telegram.
    *   [ ] Реализовать надежную обработку ошибок сети и API Telegram.

### Фаза 3: Разработка админ-панели (День 4)

**Цель:** Создать веб-интерфейс для управления списком логистов.

1.  **Backend (Express/TypeScript):**
    *   [ ] Создать REST API эндпоинты для CRUD-операций (Create, Read, Update, Delete) над таблицей логистов.
    *   [ ] Реализовать базовую, но надежную аутентификацию (например, по JWT-токену или сессиям) для защиты доступа к панели.

2.  **Frontend (HTML/CSS/Vanilla JS):**
    *   [ ] Создать простую и понятную HTML-страницу для админ-панели.
    *   [ ] Написать JavaScript-код для взаимодействия с Backend API: отображение списка, добавление, удаление логистов.
    *   [ ] Обеспечить защиту от CSRF-атак (например, используя `csurf` в Express).

### Фаза 4: Развертывание и интеграция с реальным API (Дни 5-6)

**Цель:** Перенести приложение на сервер, подключить к реальному API и запустить в продуктивном режиме.

1.  **Подготовка сервера:**
    *   [ ] Создать аккаунт для клиента на выбранном хостинге (VPS).
    *   [ ] Настроить сервер: установить `Node.js`, `npm`/`yarn`, `Git`, `Nginx`, `Supervisor`.
    *   [ ] Настроить firewall, разрешив только необходимые порты (SSH, HTTP/HTTPS).

2.  **Развертывание приложения:**
    *   [ ] Загрузить код на сервер через Git.
    *   [ ] Установить зависимости.
    *   [ ] Настроить `Supervisor` для автоматического запуска и мониторинга процесса бота и админ-панели.
    *   [ ] Настроить `Nginx` как обратный прокси для админ-панели.
    *   [ ] Установить SSL-сертификат от Let's Encrypt для безопасного HTTPS-соединения.

3.  **Интеграция с реальным API ATI.SU:**
    *   [ ] Получить от заказчика действующий токен доступа к API.
    *   [ ] Заменить в коде адреса Mock-сервера на реальные URL API ATI.SU.
    *   [ ] Настроить приложение для использования токена из переменных окружения (`process.env.ATI_TOKEN`).
    *   [ ] Убедиться, что все запросы к API ATI.SU включают заголовок `Authorization: Bearer <токен>`.
    *   [ ] Адаптировать код под реальную структуру ответов API, если она отличается от моков.

4.  **Финальное тестирование и сдача:**
    *   [ ] Провести полное end-to-end тестирование всего функционала с реальными данными.
    *   [ ] Провести аудит безопасности: проверить зависимости на уязвимости (`npm audit`), убедиться в безопасности настроек сервера.
    *   [ ] Передать заказчику все доступы и краткую инструкцию по управлению приложением и обновлению токена.
