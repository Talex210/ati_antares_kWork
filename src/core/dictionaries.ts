// src/core/dictionaries.ts
// –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ ATI API

/**
 * –°–ª–æ–≤–∞—Ä—å —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
 * –ò—Å—Ç–æ—á–Ω–∏–∫: –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ATI API + —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
 */
export const CAR_TYPES: Record<number, string> = {
  1: '–¢–µ–Ω—Ç',
  2: '–†–µ—Ñ',
  3: '–ò–∑–æ—Ç–µ—Ä–º',
  4: '–ë–æ—Ä—Ç–æ–≤–æ–π',
  5: '–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤–æ–∑',
  6: '–ê–≤—Ç–æ–≤–æ–∑',
  7: '–¶–∏—Å—Ç–µ—Ä–Ω–∞',
  8: '–°–∞–º–æ—Å–≤–∞–ª',
  9: '–ù–∏–∑–∫–æ—Ä–∞–º–Ω–∏–∫',
  10: '–§—É—Ä–≥–æ–Ω',
  11: '–ê–≤—Ç–æ–±—É—Å',
  12: '–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä',
  13: '–≠–≤–∞–∫—É–∞—Ç–æ—Ä',
  14: '–ê–≤—Ç–æ–∫—Ä–∞–Ω',
  15: '–ë–µ—Ç–æ–Ω–æ—Å–º–µ—Å–∏—Ç–µ–ª—å',
  16: '–ë–µ—Ç–æ–Ω–æ–Ω–∞—Å–æ—Å',
  17: '–ó–µ—Ä–Ω–æ–≤–æ–∑',
  18: '–õ–µ—Å–æ–≤–æ–∑',
  19: '–°–∫–æ—Ç–æ–≤–æ–∑',
  20: '–¢—Ä–∞–ª',
  21: '–ê–≤—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä',
  22: '–ù–µ–≥–∞–±–∞—Ä–∏—Ç',
  30: '–ù–µ–≥–∞–±–∞—Ä–∏—Ç', // –†–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø –∏–∑ API (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 142 –≥—Ä—É–∑–∞—Ö)
};

/**
 * –°–ª–æ–≤–∞—Ä—å —Ç–∏–ø–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏/—Ä–∞–∑–≥—Ä—É–∑–∫–∏
 */
export const LOADING_TYPES: Record<number, string> = {
  0: '', // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ "–ù–µ —É–∫–∞–∑–∞–Ω" - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
  1: '–ó–∞–¥–Ω—è—è',
  2: '–ë–æ–∫–æ–≤–∞—è',
  3: '–í–µ—Ä—Ö–Ω—è—è',
  4: '–ü–æ–ª–Ω–∞—è —Ä–∞—Å—Ç–µ–Ω—Ç–æ–≤–∫–∞',
  5: '–°–æ —Å–Ω—è—Ç–∏–µ–º —Å—Ç–æ–µ–∫',
  6: '–ì–∏–¥—Ä–æ–±–æ—Ä—Ç',
  7: '–ë–µ–∑ –≤–æ—Ä–æ—Ç',
  8: '–ê–ø–ø–∞—Ä–µ–ª–∏',
  9: '–ö–æ–Ω–∏–∫–∏',
  // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
};

/**
 * –°–ª–æ–≤–∞—Ä—å –≤–∞–ª—é—Ç
 */
export const CURRENCIES: Record<number, string> = {
  1: '‚ÇΩ', // –†—É–±–ª—å
  2: '$', // –î–æ–ª–ª–∞—Ä
  3: '‚Ç¨', // –ï–≤—Ä–æ
  4: '‚Ç¥', // –ì—Ä–∏–≤–Ω–∞
  5: '‚Ç∏', // –¢–µ–Ω–≥–µ
};

/**
 * –°–ª–æ–≤–∞—Ä—å —Ç–∏–ø–æ–≤ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≥—Ä—É–∑–∞
 */
export const DATE_TYPES: Record<number, string> = {
  0: 'üü¢ –ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ',
  1: 'üìÖ –° –¥–∞—Ç—ã –ø–æ –¥–∞—Ç—É',
  2: 'üîÑ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ',
  3: '‚ùì –ì—Ä—É–∑–∞ –Ω–µ—Ç, –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–≤–∫–∏',
};

/**
 * –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –±–∏—Ç–æ–≤—É—é –º–∞—Å–∫—É CarType –≤ –º–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤
 */
function decodeCarTypeBitmask(carType: number): number[] {
  const types: number[] = [];
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –±–∏—Ç (–æ—Ç 0 –¥–æ 63)
  for (let bit = 0; bit < 64; bit++) {
    const mask = Math.pow(2, bit);
    if ((carType & mask) !== 0) {
      // –ë–∏—Ç –≤–∫–ª—é—á–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø (bit + 1)
      types.push(bit + 1);
    }
  }
  
  return types;
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–∞–∫ –∏ –º–∞—Å—Å–∏–≤—ã –∏ –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏
 */
export function getCarTypeName(carType: number | number[] | undefined | null): string {
  if (carType === undefined || carType === null) {
    return '–ù–µ —É–∫–∞–∑–∞–Ω';
  }

  // –ï—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤
  if (Array.isArray(carType)) {
    if (carType.length === 0) {
      return '–ù–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–ø—ã (1-22, 30)
    const validTypes = carType.filter(type => (type > 0 && type <= 22) || type === 30);
    
    if (validTypes.length === 0) {
      return '–ù–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –º–Ω–æ–≥–æ —Ç–∏–ø–æ–≤ (–±–æ–ª—å—à–µ 3), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–æ–±—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    if (validTypes.length > 3) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ –Ω–∏—Ö –Ω–µ–≥–∞–±–∞—Ä–∏—Ç (22 –∏–ª–∏ 30)
      if (validTypes.includes(22) || validTypes.includes(30)) {
        return '–ù–µ–≥–∞–±–∞—Ä–∏—Ç';
      }
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–∫—Ä—ã—Ç—ã–µ —Ç–∏–ø—ã (—Ç–µ–Ω—Ç, —Ä–µ—Ñ, –∏–∑–æ—Ç–µ—Ä–º, —Ñ—É—Ä–≥–æ–Ω)
      const closedTypes = [1, 2, 3, 10];
      if (validTypes.every(type => closedTypes.includes(type))) {
        return '–ó–∞–∫—Ä—ã—Ç—ã–π —Ç–∏–ø';
      }
      return '–†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã';
    }
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ 1-3 —Ç–∏–ø–∞, –ø–µ—Ä–µ—á–∏—Å–ª—è–µ–º –∏—Ö
    const names = validTypes
      .map(type => CAR_TYPES[type])
      .filter(Boolean)
      .join(', ');
    return names || '–ù–µ —É–∫–∞–∑–∞–Ω';
  }

  // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  if (typeof carType === 'number') {
    // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π ID (1-22, 30)
    if ((carType > 0 && carType <= 22) || carType === 30) {
      return CAR_TYPES[carType] || '–ù–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –±–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞ (–±–æ–ª—å—à–µ 22 –∏ –Ω–µ 30)
    if (carType > 22 && carType !== 30) {
      const types = decodeCarTypeBitmask(carType);
      // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–ø—ã (1-22, 30)
      const validTypes = types.filter(type => (type > 0 && type <= 22) || type === 30);
      
      if (validTypes.length === 0) {
        return '–ù–µ —É–∫–∞–∑–∞–Ω';
      }
      
      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –º–Ω–æ–≥–æ —Ç–∏–ø–æ–≤ (–±–æ–ª—å—à–µ 3), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–æ–±—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
      if (validTypes.length > 3) {
        if (validTypes.includes(22) || validTypes.includes(30)) {
          return '–ù–µ–≥–∞–±–∞—Ä–∏—Ç';
        }
        const closedTypes = [1, 2, 3, 10];
        if (validTypes.every(type => closedTypes.includes(type))) {
          return '–ó–∞–∫—Ä—ã—Ç—ã–π —Ç–∏–ø';
        }
        return '–†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã';
      }
      
      // –ï—Å–ª–∏ 1-3 —Ç–∏–ø–∞, –ø–µ—Ä–µ—á–∏—Å–ª—è–µ–º
      const names = validTypes
        .map(type => CAR_TYPES[type])
        .filter(Boolean)
        .join(', ');
      return names || '–ù–µ —É–∫–∞–∑–∞–Ω';
    }
  }
  
  return '–ù–µ —É–∫–∞–∑–∞–Ω';
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–≥—Ä—É–∑–∫–∏/—Ä–∞–∑–≥—Ä—É–∑–∫–∏
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–∞–∫ –∏ –º–∞—Å—Å–∏–≤—ã
 */
export function getLoadingTypeName(loadingType: number | number[] | undefined | null): string {
  if (loadingType === undefined || loadingType === null) {
    return '';
  }

  // –ï—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤
  if (Array.isArray(loadingType)) {
    if (loadingType.length === 0) {
      return '';
    }
    
    const names = loadingType
      .map(type => LOADING_TYPES[type] || `–¢–∏–ø ${type}`)
      .join(', ');
    return names;
  }

  // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  return LOADING_TYPES[loadingType] || '';
}
